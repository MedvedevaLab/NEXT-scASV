// Nextflow Configuration File for NEXT-ASV Pipeline

params {
    // ==========================================
    // INPUT/OUTPUT DIRECTORIES AND FILES
    // ==========================================
    
    // Main input/output directories
    input = ""
    outdir = ""
    workdir = ""
    tmp_dir = ""
    
    // Metadata and configuration files
    split_table = "split_table.tsv"
    meta_json = "meta.json"
    
    // ==========================================
    // REFERENCE GENOME AND ANNOTATION FILES
    // ==========================================
    
    // Genome files
    genome = ""
    ref_genome = ""
    nuclear_chroms = ""
    genome_chrom_sizes = ""
    autosomes = ""
    
    // Mapping index
    hisat2_index = ""
    
    // Variant databases
    dbsnp = ""
    
    // ==========================================
    // PIPELINE STEP CONTROL
    // ==========================================
    
    // Which steps to run (true/false)
    run_split = true
    run_remap = true
    run_call = true
    run_count_reads = true
    run_find_ase = true

    // ==========================================
    // VARIANT CALLING AND FILTERING PARAMETERS
    // ==========================================
    
    // Quality filtering thresholds
    min_GQ = 50    // Minimum genotype quality
    min_DP = 10    // Minimum read depth over SNP
    min_AD = 5     // Minimum reads per alleles

    // ==========================================
    // COUNT_READS WORKFLOW PARAMETERS
    // ==========================================
    
    // H5 files directory (set to null to generate new ones)
    h5_files_b = null
    
    // Processed BAMs and called variants directories
    processed_bams_dir = "${params.outdir}/align"
    called_dir = "${params.outdir}"

        
    // ==========================================
    // ASE ANALYSIS PARAMETERS
    // ==========================================
    
    // ASE model to use
    model = "BetaNB"
    annotation_meta_dir = null // if null - use default files from bin/annotation/*pickle
    
    
    // ==========================================
    // PROCESS-SPECIFIC PARAMETERS
    // ==========================================
    
    // These are typically derived from other parameters but can be overridden
    genotype_file = null  // Will be set to "${called_dir}/all.filtered.annotated.snps.vcf.gz"
    vcf_dir = null        // Will be set based on count_reads output
    snvs_dir = null       // Will be set based on find_ase output
    annotation_pickle = null
}

// ==========================================
// EXECUTION CONFIGURATION
// ==========================================

// Enable Docker if available
docker {
    enabled = true  // Set to true if using Docker
    runOptions = '-u $(id -u):$(id -g)'
}

// Enable Singularity if available
singularity {
    enabled = false  // Set to true if using Singularity
    autoMounts = true
}

// Work directory configuration
workDir = "${params.outdir}/work"

// Timeline and execution reports
timeline {
    enabled = false
    file = "${params.outdir}/reports/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/reports/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/reports/trace.txt"
}

dag {
    enabled = false
    file = "${params.outdir}/reports/dag.dot"
}

process {
    executor = 'slurm'
    queue = 'cpu'
    cpus = 6
    memory = '16 GB'
    
    // Global environment variables for all processes
    env {
        MPLCONFIGDIR = "${params.tmp_dir}"
        TEMP = "${params.tmp_dir}"
        TMP = "${params.tmp_dir}"
        RES_TMPDIR = "${params.tmp_dir}"
    }
}